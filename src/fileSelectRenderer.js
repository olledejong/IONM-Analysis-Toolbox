// inform the Main Process that it has to open a file select window
variable_content.on("click", '.file-selectBtn', function() {
    ipcRenderer.send("select-file", "");
});

/**
 * Receive the information of the selected files via message "selected"
 * and display the filenames ( generated by generateFilenames() )
 * @param {object} IpcRendererEvent, contains all information about the event
 * @param {array} Contains the paths of all selected files
 */
ipcRenderer.on("selected", function (event, paths) {
    // jQuery selector(s)
    let run_button = $(".run-button");
    let file_select_button = $(".file-selectBtn");
    let selected_filenames_p = $('#selected-filenames');

    // only do something if there are actually files are selected
    if(paths.length !== 0) {
        let finalFileNames = generateFilenames(paths);

        // set text inside the button to selected files
        selected_filenames_p.html(finalFileNames);

        // show run button and enable it
        if ( run_button.prop('disabled') === true ) {
            // run_button.stop().animate({
            //     top: '0', opacity: 1
            // }, 1000);
            run_button.css({
                'right': '0',
                'opacity' : '1'
            });
        }
        run_button.prop('disabled', false);

    // disable run button when file selection cancelled
    } else {
        selected_filenames_p.html('No files selected');
        run_button.css({
            'right': '-100px',
            'opacity' : '0'
        });
        // run_button.stop().animate({
        //     top: '-60px', opacity: 1
        // }, 1000);
        run_button.prop('disabled', true);
    }
});

/**
 * For every absolute path in the given array, this function returns
 * its filename for the purpose of displaying it to the user.
 * @param {string} paths
 * @returns {string} a filename followed by a html linebreak
 */
function generateFilenames(paths) {
    let fileNameList = [];
    // loop through list of filepaths
    for (let i = 0; i < paths.length; i++) {
        let lastIndex = paths[i].lastIndexOf('\\');
        let substring = paths[i].substring((lastIndex + 1), paths[i].length);
        // after every two filenames push a linebreak, but dont do this for the first element
        if( (i % 2) !== 0 && (i !== 0) ) {
            fileNameList.push(substring);
            fileNameList.push('<br>');
            log.info('modulo ',i, ' is 0')
        } else if ( paths.length !== 1 ) {
            fileNameList.push(substring);
            fileNameList.push('&nbsp;&nbsp;&nbsp;&nbsp;');
        } else {
            fileNameList.push(substring);
        }
    }
    return fileNameList.join('');
}